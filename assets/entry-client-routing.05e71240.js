import{a,b as P,i as ue,p as $,c,m as w,h as I,s as S,d as f,e as ce,o as g,f as Ge,_ as z,g as Ke,j as Ye,k as Je,l as Me,n as qe,q as C,r as Xe,t as Qe,u as Ze,v as A,w as fe,x as et,y as tt,z as nt,A as de,B as rt,C as ge,D as st,E as he,F as pe,G as L,H as it}from"./chunk-b4d9a5af.js";function _(e){return typeof e!="object"||e===null?!1:Object.getPrototypeOf(e)===null?!0:e.constructor.name==="Object"}function Z(e){return"["+e.map(t=>"'"+t+"'").join(", ")+"]"}function B(e,t){const n=Object.getOwnPropertyDescriptor(e,t);return!!n&&!("value"in n)&&!!n.get}function K(e){a(e.urlOriginal),"urlPathname"in e?a(B(e,"urlPathname")):Object.defineProperty(e,"urlPathname",{get:ye,enumerable:!0,configurable:!0}),"url"in e?a(B(e,"url")):Object.defineProperty(e,"url",{get:ot,enumerable:!1,configurable:!0}),"urlParsed"in e?a(B(e,"urlParsed")):Object.defineProperty(e,"urlParsed",{get:at,enumerable:!0,configurable:!0})}function me(e){let t=e.urlOriginal;const{_baseUrl:n,_urlProcessor:r}=e;return a(n.startsWith("/")),a(r===null||ue(r)),r!==null&&(t=r(t)),$(t,n)}function ye(){const{pathname:e}=me(this),t=e;return a(t.startsWith("/")),t}function ot(){return P(!1,"`pageContext.url` is outdated. Use `pageContext.urlPathname`, `pageContext.urlParsed`, or `pageContext.urlOriginal` instead. (See https://vite-plugin-ssr.com/migration/0.4.23 for more information.)",{onlyOnce:!0,showStackTrace:!0}),ye.call(this)}function at(){const e=me(this),{origin:t,pathname:n,pathnameOriginal:r,search:s,searchAll:o,searchOriginal:i,hash:l,hashOriginal:d}=e,h={origin:t,pathname:n,pathnameOriginal:r,search:s,searchAll:o,searchOriginal:i,hash:l,hashOriginal:d,get hashString(){return P(!1,"`pageContext.urlParsed.hashString` has been renamed to `pageContext.urlParsed.hashOriginal`",{onlyOnce:!0,showStackTrace:!0}),d},get searchString(){return P(!1,"`pageContext.urlParsed.searchString` has been renamed to `pageContext.urlParsed.searchOriginal`",{onlyOnce:!0,showStackTrace:!0}),i}};return ee(h,"hashString"),ee(h,"searchString"),h}function ee(e,t){const n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(e,t,{...n,enumerable:!1})}function lt(e){a(typeof e.urlOriginal=="string"),a(typeof e.urlPathname=="string"),a(_(e.urlParsed)),a(e.urlPathname===e.urlParsed.pathname)}function ut(e,t){if(!_(e))return!1;for(const n of Object.keys(e))if(!t.includes(n))return!1;return!0}function ct(e){return typeof e=="object"&&e!==null&&"then"in e&&ue(e.then)}const Y="@",G=":";function J(e,t){c(e==="*"||e.startsWith("/"),`Invalid route string \`${e}\`${e===""?" (empty string)":""}: route strings should start with a leading slash \`/\` (or be \`*\`).`),a(t.startsWith("/"));const n=e.split("/"),r=t.split("/"),s={};ft(e),e==="*"&&(e="/*");for(let o=0;o<Math.max(n.length,r.length);o++){const i=n[o],l=r[o];if(i==="*")return s["*"]=r.slice(Math.max(1,o)).join("/"),{routeParams:s};if(i&&j(i)){if(P(!i.startsWith(G),`Outdated route string \`${e}\`, use \`${e.split(G).join(Y)}\` instead.`,{onlyOnce:!0}),!l)return null;s[i.slice(1)]=l}else if((i||"")!==(l||""))return null}return{routeParams:s}}function ft(e){const t=e.split("*").length-1;c(t<=1,`Invalid route string \`${e}\`: route strings are not allowed to contain more than one glob character \`*\`.`),c(t===0||t===1&&e.endsWith("*"),`Invalid route string \`${e}\`: make sure your route string ends with the glob character \`*\`.`)}function F(e){const t=e.split("/").filter(i=>i!==""&&i!=="*");let n=0;for(const i of t){if(j(i))break;n++}const r=t.filter(i=>!j(i)).length,s=t.filter(i=>j(i)).length,o=e.endsWith("*");return{numberOfParameterSegments:s,numberOfStaticSegmentsBeginning:n,numberOfStaticSegements:r,isCatchAll:o}}function j(e){return e.startsWith(Y)||e.startsWith(G)}function te(e){const n=J(e,e);return n!==null&&Object.keys(n.routeParams).length===0}function dt(e){e.sort(gt).sort(w(t=>t.routeType==="FUNCTION"&&!!t.precedence&&t.precedence<0)).sort(w(t=>t.routeType==="STRING"&&te(t.routeString)===!1)).sort(w(t=>t.routeType==="FUNCTION"&&!t.precedence)).sort(w(t=>t.routeType==="STRING"&&te(t.routeString)===!0)).sort(w(t=>t.routeType==="FILESYSTEM")).sort(w(t=>t.routeType==="FUNCTION"&&!!t.precedence&&t.precedence>0))}function gt(e,t){var n,r;{const s=(n=e.precedence)!==null&&n!==void 0?n:0,o=(r=t.precedence)!==null&&r!==void 0?r:0;if(s!==o)return s>o?-1:1}if(!t.routeString||!e.routeString)return 0;{const o=I(i=>F(i).numberOfStaticSegmentsBeginning)(e.routeString,t.routeString);if(o!==0)return o}{const o=I(i=>F(i).numberOfStaticSegements)(e.routeString,t.routeString);if(o!==0)return o}{const o=I(i=>F(i).numberOfParameterSegments)(e.routeString,t.routeString);if(o!==0)return o}{if(F(t.routeString).isCatchAll)return-1;if(F(e.routeString).isCatchAll)return 1}return 0}function ht(e,t){return bt(e)?J(e,t):pt(e,t)}function pt(e,t){return t=mt(t),a(t.startsWith("/")),a(e.startsWith("/")),a(!t.endsWith("/")||t==="/"),a(!e.endsWith("/")||e==="/"),t!==e?null:{routeParams:{}}}function mt(e){if(!e.endsWith("/"))return e;for(;e.endsWith("/");)e=S(e,0,-1);return e===""?"/":e}function yt(e,t){const r=t.filter(({filesystemRoot:o})=>e.startsWith(o)).sort(I(({filesystemRoot:o})=>o.length))[0];let s;if(r){const{filesystemRoot:o,routeRoot:i}=r,l={pageId:e,filesystemRoot:o,routeRoot:i};a(i.startsWith("/")&&e.startsWith("/")&&o.startsWith("/"),l),a(e.startsWith(o),l),o!=="/"?(a(!o.endsWith("/"),l),s=S(e,o.length,0)):s=e,a(s.startsWith("/"),l),s=i+(i.endsWith("/")?"":"/")+S(s,1,0)}else s=e;return a(s.startsWith("/")),s=s.split("/").filter(o=>o!=="pages"&&o!=="src"&&o!=="index").join("/"),a(!s.includes(".page.")),a(!s.endsWith(".")),s.endsWith("/index")&&(s=S(s,0,-6)),s===""&&(s="/"),a(s.startsWith("/")),a(!s.endsWith("/")||s==="/"),s}function bt(e){return e.includes(Y)}async function Pt(e,t,n){lt(t);let r=e.default(t);if(c(!ct(r)||e.iKnowThePerformanceRisksOfAsyncRouteFunctions,`The Route Function ${n} returned a promise; async route functions are opt-in, see https://vite-plugin-ssr.com/route-function#async`),r=await r,r===!1)return null;if(r===!0&&(r={}),c(_(r),`The Route Function ${n} should return a boolean or a plain JavaScript object, instead it returns \`${f(r,"constructor")?r.constructor:r}\`.`),"match"in r){const{match:i}=r;if(c(typeof i=="boolean",`The \`match\` value returned by the Route Function ${n} should be a boolean.`),!i)return null}let s=null;"precedence"in r&&(s=r.precedence,c(typeof s=="number",`The \`precedence\` value returned by the Route Function ${n} should be a number.`)),be(r,`The \`routeParams\` object returned by the Route Function ${n} should`);const o=r.routeParams||{};return c(!("pageContext"in r),"Providing `pageContext` in Route Functions is forbidden, see https://vite-plugin-ssr.com/route-function#async"),a(_(o)),Object.keys(r).forEach(i=>{c(i==="match"||i==="routeParams"||i==="precedence",`The Route Function ${n} returned an object with an unknown key \`{ ${i} }\`. Allowed keys: ['match', 'routeParams', 'precedence'].`)}),{precedence:s,routeParams:o}}function be(e,t){a(t.endsWith(" should")),f(e,"routeParams")&&(c(_(e.routeParams),`${t} be a plain JavaScript object.`),c(Object.values(e.routeParams).every(n=>typeof n=="string"),`${t} only hold string values.`))}function Pe(e,{hook:t,errorMessagePrefix:n}){if(!n){a(t);const{hookName:r,hookFilePath:s}=t;a(s.startsWith("/")),a(!r.endsWith(")")),n=`The \`pageContext\` provided by the \`export { ${r} }\` of ${s}`}c(ce(e),`${n} should be an object.`),c(!("_objectCreatedByVitePluginSsr"in e),`${n} should not be the whole \`pageContext\` object, see https://vite-plugin-ssr.com/pageContext-manipulation#do-not-return-entire-pagecontext`),P(!("_pageId"in e),"You are using `onBeforeRoute()` to override vite-plugin-ssr routing. This is experimental: make sure to contact a vite-plugin-ssr maintainer before using this.",{onlyOnce:!0})}async function _t(e,t){const n=await e.onBeforeRoute(t),r=`The \`onBeforeRoute()\` hook exported by ${e.filePath}`;if(c(n==null||ut(n,["pageContext"])&&f(n,"pageContext"),`${r} should return \`null\`, \`undefined\`, or a plain JavaScript object \`{ pageContext: { /* ... */ } }\`.`),n==null)return null;if(c(f(n,"pageContext","object"),`${r} returned \`{ pageContext }\` but \`pageContext\` should be a plain JavaScript object.`),f(n.pageContext,"_pageId")&&!f(n.pageContext,"_pageId","null")){const o=`${r} returned \`{ pageContext: { _pageId } }\` but \`_pageId\` should be`;c(f(n.pageContext,"_pageId","string"),`${o} a string or \`null\``),c(t._allPageIds.includes(n.pageContext._pageId),`${o} one of following values: \`[${t._allPageIds.map(i=>`'${i}'`).join(", ")}]\`.`)}f(n.pageContext,"routeParams")&&be(n.pageContext,`${r} returned \`{ pageContext: { routeParams } }\` but \`routeParams\` should`);const s={};return f(n.pageContext,"url")&&(P(!1,`${r} returned \`{ pageContext: { url } }\` but \`pageContext.url\` has been renamed to \`pageContext.urlOriginal\`. Return \`{ pageContext: { urlOriginal } }\` instead. (See https://vite-plugin-ssr.com/migration/0.4.23 for more information.)`,{onlyOnce:!0}),n.pageContext.urlOriginal=n.pageContext.url,delete n.pageContext.url),f(n.pageContext,"urlOriginal")&&(c(f(n.pageContext,"urlOriginal","string"),`${r} returned \`{ pageContext: { urlOriginal } }\` but \`urlOriginal\` should be a string`),g(s,{_urlPristine:t.urlOriginal})),Pe(n.pageContext,{hook:{hookFilePath:e.filePath,hookName:"onBeforeRoute"}}),g(s,n.pageContext),s}async function vt(e){let t=null;const n=[];await Promise.all(e._pageFilesAll.filter(i=>i.fileType===".page.route").map(i=>{var l;return(l=i.loadFile)===null||l===void 0?void 0:l.call(i)})),e._pageFilesAll.filter(i=>i.fileType===".page.route"&&i.isDefaultPageFile).forEach(({filePath:i,fileExports:l})=>{if(a(l),"onBeforeRoute"in l){c(f(l,"onBeforeRoute","function"),`\`export { onBeforeRoute }\` of ${i} should be a function.`);const{onBeforeRoute:d}=l;t={filePath:i,onBeforeRoute:d}}"filesystemRoutingRoot"in l&&(c(f(l,"filesystemRoutingRoot","string"),`\`export { filesystemRoutingRoot }\` of ${i} should be a string.`),c(f(l,"filesystemRoutingRoot","string"),`\`export { filesystemRoutingRoot }\` of ${i} is \`'${l.filesystemRoutingRoot}'\` but it should start with a leading slash \`/\`.`),n.push({filesystemRoot:Rt(i),routeRoot:l.filesystemRoutingRoot}))});const r=e._allPageIds,s=[];return r.filter(i=>!Ge(i)).filter(i=>{const l=wt(i,e._pageFilesAll);if(!l)return!0;const{filePath:d,fileExports:h}=l;a(h),c("default"in h,`${d} should have a default export.`),c(f(h,"default","string")||f(h,"default","function"),`The default export of ${d} should be a string or a function.`),c(!("iKnowThePerformanceRisksOfAsyncRouteFunctions"in h)||f(h,"iKnowThePerformanceRisksOfAsyncRouteFunctions","boolean"),`The export \`iKnowThePerformanceRisksOfAsyncRouteFunctions\` of ${d} should be a boolean.`);const u=h.default;return s.push({pageId:i,filesystemRoute:null,pageRouteFile:{filePath:d,fileExports:h,routeValue:u}}),!1}).forEach(i=>{const l=yt(i,n);a(l.startsWith("/")),a(!l.endsWith("/")||l==="/"),s.push({pageId:i,filesystemRoute:l,pageRouteFile:null})}),{pageRoutes:s,onBeforeRouteHook:t}}function wt(e,t){return t.find(n=>n.pageId===e&&n.fileType===".page.route")}function Rt(e){a(e.startsWith("/")),a(!e.endsWith("/"));const t=e.split("/"),n=S(t,0,-1).join("/")||"/";return a(n.startsWith("/")),a(!n.endsWith("/")||n==="/"),n}var T;function ne(...e){var t,n;T||(T=(n=(t=globalThis).__brillout_debug_createDebugger)===null||n===void 0?void 0:n.call(t,"vps:routing")),T&&T(...e)}async function _e(e){K(e);const{pageRoutes:t,onBeforeRouteHook:n}=await vt(e);ne("Pages routes:",t.map(u=>({pageId:u.pageId,filesystemRoute:u.filesystemRoute,pageRouteFile:u.pageRouteFile&&{filePath:u.pageRouteFile.filePath,routeValue:u.pageRouteFile.routeValue}})));const r={};if(n){const u=await _t(n,e);if(u){if(g(r,u),f(r,"_pageId","string")||f(r,"_pageId","null"))return f(r,"routeParams")?a(f(r,"routeParams","object")):g(r,{routeParams:{}}),g(r,{_routingProvidedByOnBeforeRouteHook:!0,_routeMatches:"CUSTOM_ROUTE"}),{pageContextAddendum:r};g(e,r)}}g(r,{_routingProvidedByOnBeforeRouteHook:!1});const s=e._allPageIds;a(s.length>=0),c(s.length>0,"No `*.page.js` file found. You must create a `*.page.js` file, e.g. `pages/index.page.js` (or `pages/index.page.{jsx, tsx, vue, ...}`).");const{urlPathname:o}=e;a(o.startsWith("/"));const i=[];await Promise.all(t.map(async u=>{const{pageId:m,filesystemRoute:O,pageRouteFile:x}=u;if(x){const y=x.fileExports,v=x.filePath;if(f(y,"default","string")){const p=y.default;c(p.startsWith("/"),`A Route String should start with a leading \`/\` but \`${v}\` has \`export default '${p}'\`. Make sure to \`export default '/${p}'\` instead.`);const b=J(p,o);if(b){const{routeParams:U}=b;i.push({pageId:m,routeString:p,routeParams:U,routeType:"STRING"})}}else if(f(y,"default","function")){const p=await Pt(y,e,v);if(p){const{routeParams:b,precedence:U}=p;i.push({pageId:m,precedence:U,routeParams:b,routeType:"FUNCTION"})}}else a(!1)}else{const y=ht(O,o);if(y){const{routeParams:v}=y;i.push({pageId:m,routeParams:v,routeType:"FILESYSTEM"})}}})),dt(i);const l=i[0];if(ne(`Route matches for URL \`${o}\` (in precedence order):`,i),g(r,{_routeMatches:i}),!l)return g(r,{_pageId:null,routeParams:{}}),{pageContextAddendum:r};const{pageId:d,routeParams:h}=l;return a(_(h)),g(r,{_pageId:d,routeParams:h}),{pageContextAddendum:r}}const M={},ve={},St={},H={},Ot={},xt=!0,Ft=Object.assign({"/pages/index/index.page.jsx":()=>z(()=>import("./pages/index/index.page.e838846e.js"),["assets/pages/index/index.page.e838846e.js","assets/index.page.5ac766f6.css","assets/chunk-4a07c23a.js"]),"/renderer/_error.page.jsx":()=>z(()=>import("./renderer/_error.page.8f1e37b2.js"),["assets/renderer/_error.page.8f1e37b2.js","assets/chunk-4a07c23a.js"])}),At={...Ft};M[".page"]=At;const Ct=Object.assign({}),Tt={...Ct};ve[".page.route"]=Tt;const Et=Object.assign({"/renderer/_default.page.client.jsx":()=>z(()=>import("./renderer/_default.page.client.ecc665d4.js"),["assets/renderer/_default.page.client.ecc665d4.js","assets/chunk-4a07c23a.js"])}),It={...Et};M[".page.client"]=It;const jt=Object.assign({"/renderer/_default.page.client.jsx":Ke}),kt={...jt};H[".page.client"]=kt;const Wt=Object.assign({"/renderer/_default.page.server.jsx":Ye}),$t={...Wt};H[".page.server"]=$t;const Ht=Object.assign({"/pages/index/index.page.jsx":Je,"/renderer/_error.page.jsx":Me}),Nt={...Ht};H[".page"]=Nt;const Ut=Object.freeze(Object.defineProperty({__proto__:null,pageFilesLazy:M,pageFilesEager:ve,pageFilesExportNamesLazy:St,pageFilesExportNamesEager:H,neverLoaded:Ot,isGeneratedFile:xt},Symbol.toStringTag,{value:"Module"}));qe(Ut);function we(){const e="/ColoradoPopulationViewer/";return Lt(e)?"/":e}function Lt(e){return!!e.startsWith("http")}function Re(e){return!e.startsWith("/")&&!e.startsWith(".")&&!e.startsWith("?")&&e!==""}function Bt(e,t){let n=!1;return()=>{n||(n=!0,setTimeout(()=>{n=!1,e()},t))}}function Vt(e){return $(e,"/").pathname}function N(e){window.location.href=e}const Dt="/";function zt(e,t,n){a(t!==".pageContext.json"||n===!0,{fileExtension:t,doNotCreateExtraDirectory:n});const{pathnameOriginal:r,searchOriginal:s,hashOriginal:o}=$(e,Dt);e.startsWith("/")&&a(e===`${r}${s||""}${o||""}`,{url:e});let i=r;if(n)i.endsWith("/")&&(i=S(i,0,-1)),a(!i.endsWith("/"),{url:e,pathnameModified:i}),i===""&&(i="/index");else{const d=r.endsWith("/")?"":"/";i=i+`${d}index`}return`${i}${t}${s||""}${o||""}`}function Gt(){return!!Kt()}function Kt(){var e,t,n,r;const s=!!(!((t=(e=window.__REACT_DEVTOOLS_GLOBAL_HOOK__)===null||e===void 0?void 0:e.renderers)===null||t===void 0)&&t.size),o=!!(!((r=(n=window.__REACT_DEVTOOLS_GLOBAL_HOOK__)===null||n===void 0?void 0:n.rendererInterfaces)===null||r===void 0)&&r.size),i=!!window.__vite_plugin_react_preamble_installed__,l=d=>{P(d,"An internal heuristic needs to be updated, see https://github.com/brillout/vite-plugin-ssr/issues/423",{onlyOnce:!0})};return s||o?(l(s&&i),!0):i?(a(s===!1&&o===!1),!0):!1}function Yt(e,t){return(e==null?void 0:e.message)===(t==null?void 0:t.message)}function Jt(e){return new Promise(t=>setTimeout(t,e))}const Mt=C();let re=!1;const Se={markNavigationChange(){re=!0},get noNavigationChangeYet(){return!re&&this.isFirstUrl(C())},isFirstUrl(e){return e===Mt}};function Oe(e,t){return Xe(e,t)}async function qt(e,t){const r=Oe(e,t).filter(o=>o.fileType===".page.server");return await Promise.all(r.map(async o=>{o.exportNames||(a(o.loadExportNames,t),await o.loadExportNames())})),{hasOnBeforeRenderServerSideOnlyHook:r.some(({exportNames:o})=>(a(o),o.includes("onBeforeRender")))}}function Xt(e,t,n,r){a(!t.endsWith(")"));const s=`The \`export { ${t} }\` of ${r}`;c(e==null||_(e),`${s} should return \`null\`, \`undefined\`, or a plain JavaScript object.`),e!=null&&(Qt(e,n,s),"pageContext"in e&&Pe(e.pageContext,{hook:{hookName:t,hookFilePath:r}}))}function Qt(e,t,n){const r=[],s=Object.keys(e);for(const o of s)t.includes(o)||r.push(o);c(r.length===0,[n,"returned an object with unknown keys",Z(r)+".","Only following keys are allowed:",Z(t)+"."].join(" "))}function xe(e){return a([!0,!1].includes(e.isHydration)),a([!0,!1,null].includes(e.isBackwardNavigation)),Qe(e)}const se=["urlPathname","urlParsed"],Zt=["Page","pageExports","exports"];function Fe(e){[...Zt,...se].forEach(n=>{n in e&&(se.includes(n)?(a(n.startsWith("url")),P(!1,`\`pageContext.${n}\` is already available in the browser when using \`useClientRouter()\`; including \`${n}\` in \`passToClient\` has no effect.`,{onlyOnce:!0})):P(!1,`\`pageContext.${n}\` is a built-in that cannot be overriden; including \`${n}\` in \`passToClient\` has no effect.`,{onlyOnce:!0}),delete e[n])})}async function en(e){return e._isFirstRenderAttempt&&Se.isFirstUrl(e.urlOriginal)?(a(f(e,"_isFirstRenderAttempt","true")),tn(e)):(a(f(e,"_isFirstRenderAttempt","false")),rn(e))}async function tn(e){const t=Ze();return Fe(t),g(t,{isHydration:!0,_comesDirectlyFromServer:!0}),g(t,await A(e._pageFilesAll,t._pageId)),t}async function nn(e){const t=fe(e._allPageIds);if(!t)throw new Error("No error page");const n={isHydration:!1,_pageId:t,_pageContextRetrievedFromServer:null,_comesDirectlyFromServer:!1};return g(n,await A(e._pageFilesAll,n._pageId)),n}async function rn(e){let t={};g(t,{isHydration:!1}),g(t,await on(e)),g(t,await A(e._pageFilesAll,t._pageId));const n=await sn({...e,...t});if(a([!0,!1].includes(n._comesDirectlyFromServer)),n._isError){t={},a(n._comesDirectlyFromServer===!0),a(f(n,"is404","boolean")),a(f(n,"pageProps","object")),a(f(n.pageProps,"is404","boolean")),a(!("serverSideError"in n));const r=fe(e._allPageIds);return a(r),g(t,{isHydration:!1,_pageId:r}),g(t,n),g(t,await A(e._pageFilesAll,t._pageId)),t}else return g(t,n),t}async function sn(e){const t=et(e,"onBeforeRender");if(t){const r=t.hook,s={_comesDirectlyFromServer:!1,_pageContextRetrievedFromServer:null},o=xe({...e,...s}),i=await r(o);Xt(i,"onBeforeRender",["pageContext"],t.filePath);const l=i==null?void 0:i.pageContext;return g(s,l),s}else if((await qt(e._pageFilesAll,e._pageId)).hasOnBeforeRenderServerSideOnlyHook){const r=await an(e),s={};return Object.assign(s,r),g(s,{_comesDirectlyFromServer:!0,_pageContextRetrievedFromServer:r}),s}return{_comesDirectlyFromServer:!1,_pageContextRetrievedFromServer:null}}async function on(e){const n=(await _e(e)).pageContextAddendum;if(!n._pageId)throw new Error("No routing match");return a(f(n,"_pageId","string")),n}async function an(e){var t;const n=zt((t=e._urlPristine)!==null&&t!==void 0?t:e.urlOriginal,".pageContext.json",!0),r=await fetch(n);{const l=r.headers.get("content-type"),d=l&&l.includes("application/json");if(!d&&r.status===404){N(e.urlOriginal);const h=new Error("Page doesn't exist");throw Object.assign(h,{_abortRendering:!0}),h}c(d,`Wrong HTTP Response Header \`content-type\` value for URL ${n} (it should be \`application/json\` but we got \`${l}\`). Make sure to use \`pageContext.httpResponse.contentType\`, see https://github.com/brillout/vite-plugin-ssr/issues/191`)}const s=await r.text(),o=tt(s);if("serverSideError"in o)throw nt("`pageContext` could not be fetched from the server as an error occurred on the server; check your server logs.");a(f(o,"pageContext"));const i=o.pageContext;return a(_(i)),a(f(i,"_pageId","string")),Fe(i),i}let V;async function Ae(){return V||(V=await ln()),V}async function ln(){const e=we();de(e);const t={_urlProcessor:null,_baseUrl:e,_objectCreatedByVitePluginSsr:!0,_isProduction:!0},{pageFilesAll:n,allPageIds:r}=await rt(!0);return g(t,{_pageFilesAll:n,_allPageIds:r}),t}async function Ce(e){const t=await Ae(),n={urlOriginal:e,...t},r=t._pageFilesAll;K(n);const s=await _e(n);if(!("pageContextAddendum"in s))return{pageId:null,pageFilesAll:r};const o=s.pageContextAddendum._pageId;return o?{pageId:o,pageFilesAll:r}:{pageId:null,pageFilesAll:r}}function k(e){return e.exportNames?e.exportNames:(a(e.fileExports,e.pageId),Object.keys(e.fileExports))}function un({pageFilesClientSide:e,pageFilesServerSide:t,pageId:n}){return{isHtmlOnly:r(),isClientRouting:o()};function r(){return t.some(d=>d.pageId===n&&d.fileType===".page")?(s(),!1):t.some(d=>d.pageId===n&&d.fileType===".page.server")}function s(){const i=e.some(l=>k(l).includes("render"));c(i,["No client-side `render()` hook found.","See https://vite-plugin-ssr.com/render-modes for more information.",["Loaded client-side page files (none of them `export { render }`):",...e.map((l,d)=>` (${d+1}): ${l.filePath}`)].join(`
`)].join(" "))}function o(){return e.some(l=>k(l).includes("clientRouting"))}}function cn({pageFilesClientSide:e,pageFilesServerSide:t,isHtmlOnly:n,isClientRouting:r}){let s=[];const o=t.filter(l=>!e.includes(l)),i=[];if(i.push(...e.map(l=>({id:l.filePath,onlyAssets:!1}))),i.push(...o.map(l=>({id:l.filePath,onlyAssets:!0}))),n)s=e.map(l=>l.filePath);else{const l=r?"@@vite-plugin-ssr/dist/esm/client/router/entry.js":"@@vite-plugin-ssr/dist/esm/client/entry.js";i.push({id:l,onlyAssets:!1}),s=[l]}return{clientEntries:s,clientDependencies:i}}function fn(e,t){let n=ge(e,t);const r=Oe(e,t),{isHtmlOnly:s,isClientRouting:o}=un({pageFilesClientSide:n,pageFilesServerSide:r,pageId:t});s&&(n=n.filter(d=>d.fileType===".page.client"&&!k(d).includes("render")),n=gn(n));const{clientEntries:i,clientDependencies:l}=cn({pageFilesClientSide:n,pageFilesServerSide:r,isHtmlOnly:s,isClientRouting:o});return{isHtmlOnly:s,isClientRouting:o,clientEntries:i,clientDependencies:l,pageFilesClientSide:n,pageFilesServerSide:r}}async function dn(e,t,{sharedPageFilesAlreadyLoaded:n}){const r=ge(e,t);await Promise.all(r.map(async s=>{var o;a(s.fileType===".page"||s.fileType===".page.client"),!(n&&s.fileType===".page")&&await((o=s.loadExportNames)===null||o===void 0?void 0:o.call(s))}))}function gn(e){const t=[];for(const n of e)if(t.push(n),k(n).includes("overrideDefaultPages"))break;return t}async function Te(e){const{pageId:t,pageFilesAll:n}=await Ce(e);if(!t)return!1;await dn(n,t,{sharedPageFilesAlreadyLoaded:!1});const{isHtmlOnly:r,isClientRouting:s}=fn(n,t);return!r&&s}function Ee(e){const t=e.getAttribute("href");return!!(t===null||t===""||Re(t)||hn(e)||pn(t)||!mn(t)||!st(t))}function hn(e){const t=e.getAttribute("target"),n=e.getAttribute("rel");return t==="_blank"||t==="_external"||n==="external"||e.hasAttribute("download")}function pn(e){if(e.startsWith("#"))return!0;const t=n=>n.split("#")[0];return!!(e.includes("#")&&t(e)===t(window.location.href))}function mn(e){const t=we();de(t);const{hasBaseUrl:n}=$(e,t);return n}function yn(e,t){const n=bn(e,t);return{prefetchPageContext:!1,prefetchStaticAssets:n}}function bn(e,t){let n=Pn(t),r=(()=>{if(n!==null)return n===!0?{when:"VIEWPORT"}:{when:"HOVER"};if("prefetchLinks"in e.exports&&c(n===null,"`export { prefetchLinks }` is deprecated, use `export { prefetchStaticAssets }` instead."),"prefetchStaticAssets"in e.exports){const{prefetchStaticAssets:s}=e.exports;if(s===!1)return!1;const o="`prefetchStaticAssets` should be either `false`, `{ when: 'VIEWPORT' }`, or `{ when: 'HOVER' }`";c(_(s),o);const i=Object.keys(s);c(i.length===1&&i[0]==="when",o);const{when:l}=s;if(l==="HOVER"||l==="VIEWPORT")return{when:l};c(!1,o)}return{when:"HOVER"}})();return r&&r.when==="VIEWPORT"&&!e._isProduction&&(he(!1,"Viewport prefetching is disabled in development",{onlyOnce:!0}),r={when:"HOVER"}),r}function Pn(e){let t=e.getAttribute("data-prefetch");if(P(t===null,"The `data-prefetch` attribute is outdated.",{onlyOnce:!0}),t===null)return null;if(a(typeof t=="string"),t==="true")return!0;if(t==="false")return!1;c(!1,`Wrong data-prefetch value: \`"${t}"\`; it should be \`"true"\` or \`"false"\`.`)}const Ie=new Map;function je(e){const t=We(e);return Ie.has(t)}function ke(e){const t=We(e);Ie.set(t,!0)}function We(e){return Vt(e)}const ie=new Map;async function D(e){if(c(!Re(e),`You are trying to prefetch ${e} which is an external URL. This doesn't make sense since vite-plugin-ssr cannot prefetch external links.`),je(e))return;ke(e);const{pageId:t,pageFilesAll:n}=await Ce(e);if(t)try{await A(n,t)}catch(r){if(pe(r))Be();else throw r}}function _n(e){ke(e.urlOriginal),[...document.getElementsByTagName("A")].forEach(async n=>{if(ie.has(n))return;ie.set(n,!0);const r=n.getAttribute("href");if(Ee(n)||(a(r),!await Te(r))||je(r))return;const s=yn(e,n);if(s.prefetchStaticAssets){if(s.prefetchStaticAssets.when==="HOVER")n.addEventListener("mouseover",()=>D(r)),n.addEventListener("touchstart",()=>D(r),{passive:!0});else if(s.prefetchStaticAssets.when==="VIEWPORT"){const o=new IntersectionObserver(i=>{i.forEach(l=>{l.isIntersecting&&(D(r),o.disconnect())})});o.observe(n)}}else return})}function $e(){let e=window.history.state;e||(e={});let t=!1;"timestamp"in e||(t=!0,e.timestamp=Ne()),"scrollPosition"in e||(t=!0,e.scrollPosition=He()),Ue(e),t&&X(e)}function q(){const e=window.history.state||{};return Ue(e),e}function He(){return{x:window.scrollX,y:window.scrollY}}function Ne(){return new Date().getTime()}function oe(){const e=He(),t=q();X({...t,scrollPosition:e})}function vn(e,t){if(t)X(q(),e);else{const n=Ne();wn({timestamp:n,scrollPosition:null},e)}}function Ue(e){if(a(ce(e)),"timestamp"in e){const{timestamp:t}=e;a(typeof t=="number")}if("scrollPosition"in e){const{scrollPosition:t}=e;t!==null&&a(f(t,"x","number")&&f(t,"y","number"))}}function X(e,t){window.history.replaceState(e,"",t)}function wn(e,t){window.history.pushState(e,"",t)}Tn();$e();let E,Le=!1;function Be(){Le=!0,he(!1,"New deployed frontend detected. The next page navigation will use Server Routing instead of Client Routing.",{onlyOnce:!0})}function Rn(){An(),Sn((s,{keepScrollPosition:o})=>{r({scrollTarget:o?"preserve-scroll":"scroll-to-top-or-hash",url:s,isBackwardNavigation:!1})}),On((s,o)=>{r({scrollTarget:s,isBackwardNavigation:o})}),globalThis.__vite_plugin_ssr__navigate=async(s,{keepScrollPosition:o,overwriteLastHistoryEntry:i})=>{await r({scrollTarget:o?"preserve-scroll":"scroll-to-top-or-hash",url:s,overwriteLastHistoryEntry:i,isBackwardNavigation:!1})};let e=0,t,n=!1;r({scrollTarget:"preserve-scroll",isBackwardNavigation:null});return;async function r({scrollTarget:s,url:o=C(),overwriteLastHistoryEntry:i=!1,isBackwardNavigation:l}){var d,h;if(Le){N(o);return}const u={urlOriginal:o,isBackwardNavigation:l},m=++e;a(m>=1),m>1&&n===!1&&(E==null||E(u),n=!0);const O=()=>Gt()&&m===1?!1:m!==e,x=await Ae();if(O())return;const y=m===1;g(u,{_isFirstRenderAttempt:y}),g(u,x),K(u);let v;try{v=await en(u)}catch(p){if(le(p,u))return;console.error(p);try{v=await nn(u)}catch(b){if(le(b,u)||(y||setTimeout(()=>{window.location.pathname=o},0),Yt(p,b)))return;throw b}}O()||(g(u,v),L(u,"onPageTransitionStart"),E=u.exports.onPageTransitionStart,t&&await t,!O()&&(xn(o,i),Se.markNavigationChange(),a(t===void 0),t=(async()=>{const p=xe(u);it(u);const b=await u.exports.render(p);c(b===void 0,"`export { render }` of "+u.exportsAll.render[0]._filePath+" should not return any value"),_n(u)})(),await t,t=void 0,u._isFirstRenderAttempt?(L(u,"onHydrationEnd"),await((h=(d=u.exports).onHydrationEnd)===null||h===void 0?void 0:h.call(d,u))):m===e&&(u.exports.onPageTransitionEnd&&(L(u,"onPageTransitionEnd"),u.exports.onPageTransitionEnd(u)),n=!1),Ve(s),Q(),De=!0))}}function Sn(e){document.addEventListener("click",t);return;async function t(s){if(!n(s))return;const o=r(s.target);if(!o)return;const i=o.getAttribute("href");if(Ee(o))return;if(a(i),s.preventDefault(),!await Te(i)){N(i);return}const l=![null,"false"].includes(o.getAttribute("keep-scroll-position"));e(i,{keepScrollPosition:l})}function n(s){return s.button===0&&!s.ctrlKey&&!s.shiftKey&&!s.altKey&&!s.metaKey}function r(s){for(;s.tagName!=="A";){const{parentNode:o}=s;if(!o)return null;s=o}return s}}let R=W();function On(e){window.addEventListener("popstate",()=>{const t=W(),n=t.historyState.scrollPosition||"scroll-to-top-or-hash",r=t.urlWithoutHash===R.urlWithoutHash,s=!t.historyState.timestamp||!R.historyState.timestamp?null:t.historyState.timestamp<R.historyState.timestamp;R=t,r?window.history.state===null?($e(),R=W()):Ve(n):e(n,s)})}function xn(e,t){C()!==e&&(Q(),vn(e,t),R=W())}function W(){return{urlWithoutHash:C({withoutHash:!0}),historyState:q()}}function Ve(e){if(e==="preserve-scroll")return;let t;if(e==="scroll-to-top-or-hash"){const n=Cn();if(n&&n!=="top"){const r=document.getElementById(n)||document.getElementsByName(n)[0];if(r){r.scrollIntoView();return}}t={x:0,y:0}}else a("x"in e&&"y"in e),t=e;Fn(t)}function Fn(e){const t=()=>window.scrollTo(e.x,e.y),n=()=>window.scrollX===e.x&&window.scrollY===e.y;n()||(t(),!n()&&requestAnimationFrame(()=>{t(),!n()&&setTimeout(async()=>{if(t(),n())return;const r=new Date().getTime();for(;;)if(await Jt(10),t(),n()||new Date().getTime()-r>100)return},0)}))}function An(){window.addEventListener("scroll",Bt(oe,Math.ceil(1e3/3)),{passive:!0}),ze(oe)}function Cn(){let{hash:e}=window.location;return e===""?null:(a(e.startsWith("#")),e=e.slice(1),e)}let De=!1;function Tn(){ae(),ze(ae),En(()=>De&&Q())}function Q(){"scrollRestoration"in window.history&&(window.history.scrollRestoration="manual")}function ae(){"scrollRestoration"in window.history&&(window.history.scrollRestoration="auto")}function ze(e){window.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&e()})}function En(e){window.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&e()})}function le(e,t){return!!(e!=null&&e._abortRendering||In(e,t))}function In(e,t){if(!pe(e))return!1;if(Be(),t._isFirstRenderAttempt)throw e;return N(t.urlOriginal),!0}Rn();
